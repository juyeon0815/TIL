# WebRTC



## WebRTC란?

- 웹 애플리케이션과 사이트가 중간자 없이 브라우저 간에 오디오나 영상 미디어를 포착하고 마음대로 스트림 할 뿐 아니라, 임의의 데이터도 교환할 수 있도록 하는 기술

- 플러그인이나 다른 소프트웨어 설치 없이 종단 간 데이터 공유와 화상 회의를 가능하게 한다

- 클라이언트-서버 구조가 아닌 사용자 간의 Peer-To-Peer 연결을 통한 통신

    → P2P연결은  중개 서버를 거치지 않기 때문에 빠른 속도 보장

    → HTTPS가 강제되기 때문에 중간자 공격에 대한 보안 보장
    
    

## P2P방식

1. 서로의 주소 공유
2. 보안 사항 및 방화벽 우회
3. 멀티미디어 데이터 실시간 교환



## WebRTC 통신 원리

![stun](/res/webrtcCommunication.png)

- 시그널링 : 프로토콜, 채널, 미디어 코덱 및 형식, 데이터 전송 방법, 라우팅 정보와 NAT 통과 방법을 포함한 통신 규격을 교환하기 위해 두 장치의 제어 종보를 교환하는 과정
- 시그널링 서버를 구축한다면 웹 소켓이나 서버 전송 이벤트 방법 적용 가능



## STUN

![stun](/res/stun.png)

- 자신의 공인 IP 주소와 포트를 확인하는 과정에 대한 프로토콜

    ⇒ 인터넷의 복잡한 주소들 속에서 유일하게 자기 자신을 식별할 수 있는 정보 반환

    ⇒ WebRTC 연결 시작 전, STUN 서버에게 요청을 보내면 NAT뒤에 있는 Peer 들을 서로 연결할 수 있도록 공인 IP와 포트를 찾아준다.

- STUN 서버를 이용했지만 정보를 알아낼 수 없다면?

    ⇒ 이유? : 라우터들간 방화벽 정책이 다를 수도 있을 뿐더러, 네트워크 연결에 대한 제한을 걸수도 있기 때문에

    ⇒ 그럼? : TURN 서버 사용
    
    

## TURN

![stun](/res/turn.png)

- STUN의 확장 개념
- 네트워크 미디어를 중개하는 서버를 이용
- 중간에 서버를 거치기 때문에, P2P 통신이라고 말하기는 애매..
- 개인 NAT 내부에 위치한 브라우저와 P2P 통신을 할 수 있는 유일한 방법



## ICE

- 두 개의 단말이 P2P 연결을 가능하게 하도록 최적의 경로를 찾아주는 프레임워크



❓NAT(네트워크 주소 변환)

- 사설 IP주소를 사용해도 문제없이 인터넷의 서비스나 웹서핑을 할 수 있는 이유 → NAT

- 사설 IP주소와 공인 IP 주소 간의 매핑 테이블을 생성하여 상호 변환해주는 기술

- 사용하는이유?

    → 사설 네트워크에 속한 여러 개의 호스트가 하나의 공인 IP 주소를 사용하여 인터넷에 접속하기 위해서
    
    

❓공인 IP vs 사설 IP

- 공인 IP (=공용 IP) : 인터넷 사용자의 로컬 네트워크를 식별하기 위해 ISP(인터넷 서비스 공급자)가 제공하는 IP주소로 외부에 공개되어 있기 때문에 다른 PC로부터 접근이 가능
- 사설 IP (=로컬 IP) : 일반 가정이나 회사 내에 할당된 네트워크의 IP주소



❓DHCP 

- 호스트의 IP주소와 각종 TCP/IP 프로토콜의 기본 설정을 클라이언트에게 자동적으로 제공해주는 프로토콜
- 장점
    1. IP설정이 자동으로 되기 때문에 효율적으로 사용 가능
    2. IP를 자동으로 할당해주기 때문에 IP 충돌 방지
- 단점
    1. DHCP 서버에 의존하기 때문에 서버가 다운되면 IP할당이 제대로 이루어지지 않음
    
    

❓NAT traversal(NAT 투과 기술) 

- 라우터를 통과해서 특정 주소나 포트와의 연결할 방법을 찾는 과정
- NAT Traversal이 필요한 이유?

    : 사설망 전화기 → 인터넷망 전화기 ( 시그널링 정상 )

      인터넷망 전화기 → 사설망 전화기 ( 방화벽 투과 X )

    ⏩사설망→인터넷망으로 나가는 미디어 트래픽은 문제가 없지만, 인터넷→사설망으로 들어오는 미디어 트래픽은 NAT 매핑 테이블이 없으므로 투과 X