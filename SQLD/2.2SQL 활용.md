

## SQL 활용



### 집합 연산자

- SELECT 절의 컬럼 수 동일, 컬럼의 데이터 타입이 상호 호환 가능해야 함

- UNION
  - 수학적 합집합을 제공하기 위해, 공통 교집합의 중복을 없애기 위한 사전작업으로 시스템에 부하를 주는 정렬 작업 발생
  - UNION과 UNION ALL의 출력 결과가 같다면, 응답 속도나 자원 효율화 측면에서 데이터 정렬 작업이 발생하지 않는 **UNION ALL을 사용하는 것을 권고**
- INTERSECTION
  - 수학의 교집합으로써 두 집합의 공통집합을 추출
- DIFFERENCE
  - 수학의 차집합으로써 첫 번째 집합에서 두 번째 집합과의 공통집합을 제외한 부분
  - EXCEPT 혹은 MINUS 사용

- PRODUCT
  - 곱집합으로, JOIN 조건이 없는 경우 생길 수 있는 모든 데이터의 조합을 의미



### FROM 절 JOIN 형태

- INNEER JOIN
  - JOIN 조건에서 동일한 값이 있는 행만 반환
  - **USING** 조건절이나 **ON** 조건절을 필수적으로 사용
  - 출력 순서 : 첫 번째 테이블 컬럼 -> 두 번째 테이블 컬럼
- NATURAL JOIN
  - INNNER JOIN의 하위 개념으로 두 테이블 간의 **동일한 이름을 갖는 모든 컬럼들에 대해 EQUI(=) JOIN** 수행
  - NATURAL JOIN이 명시되면, 추가로 USING 조건절, ON 조건절, WHERE 절에서 JOIN 조건을 정의할 수 없다.
  - JOIN에 사용된 컬럼들은 같은 데이터 유형이여야 하며, ALIAS나 테이블 명과 같은 접두사를 붙일 수 없다.
  - 출력 순서 : NATURAL JOIN의 기준이 되는 컬럼 -> 첫 번째 테이블 컬럼 -> 두 번째 테이블 컬럼



### USING 조건절

- 같은 이름을 가진 컬럼들 중에서 원하는 컬럼에 대해서만 선택적으로 EQUI JOIN을 할 수 있다.
- SQL Server에서는 지원X
- 출력 순서 : USING 조건절의 기준이 되는 칼럼 -> 첫 번째 테이블 컬럼 -> 두 번째 테이블 컬럼



### ON 조건절

- 컬럼명이 다르더라도 JOIN 조건을 사용할 수 있다.
- ALIAS나 테이블 명과 같은 접두사를 사용하여 SELECT에 사용되는 컬럼을 명확하게 지정해주어야 한다.
- FROM 절에 테이블이 많이 사용될 경우 다소 복잡하게 보여 가독성이 떨어지는 단점이 있다.



### CROSS JOIN

- PRODUCT의 개념으로 테이블 간 JOIN 조건이 없는 경우 생길 수 있는 모든 데이터의 조합을 의미
- 양쪽 집합의 M*N건의 데이터 조합 발생
- WHERE 절에 JOIN 조건 추가 가능
  - 조건을 추가했을 경우 INNER JOIN과 동일해지므로 사용 의미가 없어짐



### OUTER JOIN

- JOIN 조건에서 동일한 값이 없는 행도 반환할 때 사용할 수 있다.
- USING 조건절이나 ON 조건절을 필수적으로 사용
- LEFT (OUTER) JOIN
  - 조인 수행 시, 좌측 테이블에 해당하는 테이터를 먼저 읽은 후, 우측 테이블에서 JOIN 대상 데이터를 읽어온다.
- RIGITH (OUTER) JOIN
  - 조인 수행 시, 우측 테이블에 해당하는 데이터를 먼저 읽은 후, 좌측 테이블에서 JOIN 대상 데이터를 읽어온다.

- FULL (OUTER) JOIN
  - 조인 수행 시, 좌측/우측 테이블의 모든 데이터를 읽어 JOIN하여 결과를 생성
  - RIGHT JOIN과 LEFT JOIN의 결과를 합집합으로 처리한 결과와 동일



### 계층형 질의와 셀프 조인

- 계층형 질의 : 동일 테이블에 계층적으로 상위와 하위 데이터가 포함된 데이터
  - EX) 사원 테이블에서 사원들 사이에 상위 사원(관리자)와 하위 사원 관계 존재

- 셀프 조인 : 동일 테이블 사이의 조인
  - FROM 절에 조인 테이블이 두번 이상 나타나기 때문에 식별을 위해 반드시 테이블 별칭을 사용해야한다.



### 서브 쿼리

> 하나의 SQL문안에 포함되어 있는 또 다른 SQL문

- 서브쿼리를 괄호로 감싸서 사용한다.
- 단일 행 또는 복수 행 비교 연산자와 함께 사용가능
  - 단일 행 비교 연산자는 서브쿼리의 결과가 반드시 1건 이하,
  - 복수 행 비교 연산자는 서브쿼리의 결과 건수와 상관X
- 서브쿼리에서는 ORDER BY를 사용하지 못한다.
- SELECT 절, FROM 절, WHERE 절, HAVING 절, ORDER BY 절, INSERT문 VALUES절, UPDATE문 SET절에 사용 가능

- 동작하는 방식에 따른 서브쿼리

|     서브쿼리 종류      |                             설명                             |
| :--------------------: | :----------------------------------------------------------: |
| Un-Correlated 서브쿼리 | 서브쿼리가 메인쿼리 컬럼을 가지고 있지 않은 형태의 서브쿼리이다. 메인쿼리에 값을 제공하기 위한 목적으로 사용 |
|  Correlated 서브쿼리   | 서브쿼리가 메인쿼리 컬럼을 가지고 있는 형태의 서브쿼리이다. 메인쿼리가 먼저 수행되어 읽혀진 데이터를 서브쿼리에서 조건이 맞는지 확인하고자 할 때 사용 |

- 단일 행 서브쿼리

  - 단일 행 비교 연산자(=, <, >, <=, >=, <>)와 함께 사용할 때에는 서브쿼리의 결과 건수가 반드시 1건 이하이어야 한다.

  - 테이블 전체에 하나의 그룹함수(sum, avg)를 적용할 때는 그 결과값이 1건이 생성되기 때문에 단일 행 서브쿼리로서 사용이 가능하다.

  - EX) 정남일 선수가 소속된 팀의 선수들에 대한 정보를 출력하는 문제

    SELECT PLAYER_NAME, POSITON, BACK_NO FROM PLAYER WHERE TEAM_ID **=** (SELECT TEAM_ID FROM PLAYER WHERE PLAYER_NAME = '정남일')

    만약 선수 이름이 동명이인이 있었다면 오류 발생

- 다중 행 서브쿼리

  - 서브쿼리의 결과가 2건 이상 반환될 수 있다면 반드시 다중 행 비교 연산자(IN, ALL, ANY, SOME)과 함께 사용

  - EX) 정현수 선수가 소속되어 있는 팀 정보 출력하는 문제

    SELECT REGIN_NAME, TEAM_NAME, E_TEAM_NAME FROM TEAM WHERE TEAM_ID **IN** (SELECT TEAM_ID FROM PLAYER WHERE PLAYER_NAME ='정현수') ORDER BY TEAM_NAME;

    선수 이름이 동명이인 등 실행 결과가 2건 이상이 나오는 경우에는 다중 행 비교 연산자를 사용해야 한다.

- 다중 컬럼 서브쿼리

  - 서브쿼리의 결과로 여러 개의 컬럼이 반환되어 메인쿼리의 조건과 동시에 비교되는 것을 의미

  - EX) 소속팀별 키가 가장 작은 사람들의 정보를 출력하는 문제

    SELECT TEAM_ID, PLAYER_NAME, POSITION, BACK_NO, HEIGHT FROM PLAYER WHERE **(TEAM_ID, HEIGHT)** IN (SELECT **TEAM_ID, MIN(HEIGHT)** FROM PLAYER GROUP BY TEMP_ID) ORDER BY TEAM_ID, PLAERY_NAME;

    서브쿼리 반환 값과 WHERE 절의 컬럼 값 일치해야함

- 연관 서브쿼리
  - 서브쿼리 내에 메인쿼리 컬럼이 사용된 서브쿼리



### 뷰(View)

> 실제 데이터를 가지고 있지 않는 가상의 테이블

- 장점

| 뷰의 장점 |                             설명                             |
| :-------: | :----------------------------------------------------------: |
|  독립성   | 테이블 구조가 변경되어도 뷰를 사용하는 응용 프로그램은 변경하지 않아도 된다. |
|  편리성   | 뷰를 통해 질의를 단순하게 작성할 수 있다. 또한 해당 형태의 SQL문을 자주 사용할 때 뷰를 이용하면 펼리하게 사용할 수 있다. |
|  보안성   | 숨기고 싶은 정보가 존재한다면, 뷰를 생성할 때 해당 컬럼을 빼고 생성함으로써 사용자에게 정보를 감출 수 있다. |

