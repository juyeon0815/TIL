## SQL 기본



### 관계형 데이터베이스 개요

- 데이터베이스 
  - 특정 기업이나 개인이 필요에 의해 데이터를 일정한 형태로 저장해 놓은 것
  - 효율적인 데이터 관리 및 데이터 손상 방지
- 종류
  - 파일 시스템
    - 동시에 검색은 할 수 있으나, 동시에 검색/수정/삭제를 할 수 없기 때문에 정보의 관리가 어렵다.
    - 여러 사용자가 사용할 경우 원본 파일을 여러 개 복사하여 사용하게 되는데 만약 데이터의 변경이 있을 경우, 모든 복사본 파일에 대한 변경 작업을 진행하지 않으면 데이터의 불일치성이 발생할 수 있다.
    - 즉, 파일 시스템은 데이터의 정합성을 보장하기 어렵다.
  - 관계형 데이터베이스
    - 정규화를 통한 이상 현상을 제거하고 데이터 중복을 피할 수 있으며, 동시성 관리, 병행 제어를 통해 많은 사용자들이 동시에 데이터를 공유 및 조작할 수 있는 기능을 제공한다.
    - 인증된 사용자만이 참조할 수 있도록 하는 보안기능을 제공
    - 데이터 무결성 보장



- SQL : 관계형 데이터베이스에서 데이터 정의, 데이터 조작, 데이터 제어를 하기 위해 사용하는 언어

|     명령어의 종류     |          명령어          |                             설명                             |
| :-------------------: | :----------------------: | :----------------------------------------------------------: |
|  데이터 조작어 (DML)  |          SELECT          |           데이터를 조회하거나 검색하기 위한 명령어           |
|                       |   INSERT UPDATE DELETE   |             데이터에 변형을 가하는 종류의 명령어             |
|  데이터 정의어 (DDL)  | CREATE ALTER DROP RENAME |           데이터 구조를 정의하는데 사용되는 명령어           |
|  데이터 제어어 (DCL)  |       GRANT REVOKE       | 데이터베이스에 접근하고 사용할 수 있도록 권한을 주고 회수하는 명령어 |
| 트랜젝션 제어어 (TCL) |     COMMIT ROLLBACK      |    DML에 의해 조작된 결과를 작업단위 별로 제어하는 명령어    |



- TABLE

  |      용어       |                             설명                             |
  | :-------------: | :----------------------------------------------------------: |
  |  테이블(TABLE)  |        행과 컬럼의 2차원 구조를 가진 데이터의 저장소         |
  | 칼럼/열(COLUMN) | 2차원 구조를 가진 테이블에서 세로 방향으로 이루어진 특정 속성 |
  |     행(ROW)     | 2차원 구조를 가진 테이블에서 가로 방향으로 이루어진 연결된 데이터 |

  - 정규화
    - 데이터의 불필요한 중복을 줄이는 것
    - 데이터의 정합성 확보와 데이터 입력/수정/삭제 시 발생할 수 있는 이상현상 방지

|    용어     |                             설명                             |
| :---------: | :----------------------------------------------------------: |
|   정규화    | 테이블을 분할하여 데이터의 적합성을 확보하고, 불필요한 중복을 줄이는 프로세스 |
| 기본키 (PK) | 테이블에 존재하는 각 행을 한 가지 의미로 특정할 수 있는 한 개 이상의 컬럼 |
| 외래키 (FK) |  다른 테이블의 기본키로 사용되고 있는 관계를 연결하는 컬럼   |



### DDL

- CREATE TABLE

  > 테이블에 입력된 데이터를 정의하고, 정의한 데이터를 어떠한 데이터 유형으로 선언할 것인지 결정

  - 구문 형식

    > CREATE TABLE 테이블이름 (컬럼명 DATATYPE [DEFAULT 형식], ....);

    - 테이블 명은 객체를 의미할 수 있는 적절한 이름 사용
    - 다른 테이블의 이름과 중복되지 않아야 한다.
    - 반드시 숫자가 아닌 문자로 시작되어야 한다.
    - 특수문자 '-'는 허용되지 않는다.

  - 제약 조건 

    - 사용자가 원하는 조건의 데이터만 유지하기 위해 즉, 데이터 무결성을 유지하기 위해 특정 컬럼에 설정하는 것

    - 데이터가 이미 입력된 경우에 제약 조건을 추가/수정하기에 어려우므로 초기 테이블 생성 시점부터 제약 조건에 대한 충분한 검토가 필요하다.

      |        구분         |                             설명                             |
      | :-----------------: | :----------------------------------------------------------: |
      | PRIMARY KEY(기본키) |  행 데이터를 고유하게 식별하기 위한 기본키, NULL 사용 불가   |
      | UNIQUE KEY (고유키) |          행 데이터를 고유하게 식별하기 위한 고유키           |
      |      NOT NULL       |                     NULL 값의 입력 금지                      |
      |        CHECK        | 입력할 수 있는 값의 범위 등을 제한, TRUE or FALSE로 나타낼 수 있는 논리식 |
      | FOREIGN KEY(외래키) | 테이블 간의 관계를 정의하기 위해 기본키를 다른 테이블의 외래키로 복사하는 경우 외래키 생성 |

      

- ALTER TABLE

  > 컬럼을 추가/삭제 및 제약조건 추가/삭제하는 작업 진행

  - ADD COLUMN

    > ALTER TABLE 테이블명 ADD 추가할 컬럼명 데이터 유형;

    - 새롭게 추가된 컬럼은 테이블의 마지막 컬럼이 되며 컬럼 위치는 지정할 수 없다.

  - DROP COLUMN

    > ALTER TALBE 테이블명 DROP COLUMN 삭제할 컬럼명;

  - MODIFY COLUMN

    > ALTER TABLE 테이블명 MODIFY (컬럼명 데이터 유형 [DEFAULT 식] [NOT NULL], ...);

    - 이미 기존의 데이터가 훼손될 수 있기 때문에 컬럼의 크기를 늘릴 수는 있지만 줄이지는 못한다.
    - NULL 값만 가지고 있거나 아무 행도 없으면 컬럼의 폭을 줄일 수 있다.
    - 해당 컬럼이 NULL 값만 가지고 있다면 데이터 유형을 변경할 수 있다.
    - 변경된 DEFAULT값는 변경 작업 이후 발생하는 행 삽입에만 영향을 미친다.
    - 해당 컬럼에 NULL 값이 없을 경우 NOT NULL 제약조건을 추가할 수 있다.

  - RENAME COLUMN

    > ALTER TALBE 테이블명 RENAME COLUMN 변경해야 할 컬럼명 TO 새로운 컬럼명;

  - DROP CONSTRAINT

    > ALTER TABLE 테이블명 DROP CONSTRAINT 제약조건명;

  - ADD CONSTRAINT

    > ALTER TABLE 테이블명 ADD CONSTRAINT 제약조건명;

  - RENAME TABLE

    > RENAME 변경전 테이블 명 TO 변경할 테이블명;

  - DROP TABLE

    > DROP TABLE 테이블명;

  - TRUNCATE TABLE

    > TRUNCATE TABLE 테이블명;

    - 테이블의 전체 데이터를 삭제하는 경우, 시스템 활용 측면에서 DELETE TABLE 보다 TRUNCATE TALBE이 시스템 부하가 더 적다.



### DML

- INSERT

  > INSERT INTO 테이블명 (COLUMN_LIST) VALUES (COLUMN_LIST에 넣을 VALUE_LIST);
  >
  > INSERT INTO 테이블명 VALUES (전체 COLUMN에 넣을 VALUE_LIST);

  - 1번째 명령어의 경우, 컬럼과 입력되어야하는 값을 서로 1:1 매핑
  - 2번째 명령어의 경우, 모든 칼럼에 데이터를 입력해야하며, 컬럼의 순서대로 데이터가 입력되어야 한다.

- UPDATE

  > UPDATE 테이블명 SET 수정되어야 할 컬럼명 = 새로운 값;

- DELETE

  > DELETE [FROM] 삭제룰 원하는 정보가 들어있는 테이블 명;
  >
  > DELETE FROM 테이블 명 WHERE = 삭제하려는 조건 값;

  - 1번째 명령어의 경우, 테이블의 모든 데이터를 삭제 한다.
  - 2번째 명령어의 경우, WHERE 절에 조건에 맞는 데이터만 삭제한다.

- SELECT

  > SELECT [ALL/DISTINCT] 보고 싶은 컬럼명 FROM 테이블;

  - DISTINCT : 중복된 데이터가 있는경우 1건으로 처리해서 출력
  - ( * ) : 모든 컬럼을 보고 싶을 경우 와일드카드로 애스터리스크( * )를 사용하여 조회
  - ALIAS : 칼럼 레이블을 변경
    - EX) SELECT PLAYER_NAME AS 선수명 FROM PLAYER;
    - 별명 준간에 공백이 들어가는 경우에는 " "를 사용해야 한다.
  - 합성(CONCATENATION) 연산자
    - (ORACLE) 문자와 문자를 연결하는 경우 || 를 이용해 연결
    - (SQL SERVER) 문자와 문자를 연결하는 경우 +를 이용해 연결
    -  (공통) CONCAT(STRING1,STRING2)를 사용할 수 있다.



### TCL

> 데이터베이스의 논리적 연산단위 (ALL OR NOTING)

- 커밋 : 올바르게 반영된 데이터를 데이터베이스에 반영시키는 것
- 롤백 : 트랜잭션 시작 이전의 상태로 되돌리는 것
- 저장점 : 지점 이전에 수행 한 작업에 영향을 주지 않고 그 지점 이후에 수행한 작업을 롤백할 수 있다.
  - 복수의 저장점을 정의할 수 있으며, 동일이름으로 저장점을 정의했을 때는 나중에 정의한 저장점이 유효
- 특성

|  특성  | 설명                                                         |
| :----: | :----------------------------------------------------------- |
| 원자성 | 트랜잭션에서 정의된 연산들은 모두 성공적으로 실행되던지 아예 실행되지 않은 상태여야 한다. |
| 일관성 | 트랜잭션 실행 전에 잘못되지 않았다면 실행 후에도 잘못되지 않아야 한다. |
| 고립성 | 트랜잭션이 실행되는 도중에 다른 트랜잭션의 영향을 받아 잘못된 결과를 만들어서는 안된다 |
| 지속성 | 트랜잭션이 성공적으로 수행되면 그 트랜잭션이 갱신한 데이터베이스의 내용은 영구적으로 저장 |



### WHERE절

> SELECT [DISTINCT/ALL] 컬럼명 FROM 테이블명 WHERE 조건식 ;

- WHERE 조건절을 사용하지 않을 경우에 시스템 자원들을 과다하게 사용한다.
- WHERE 조건절이 없는 문장은 SQL 튜닝의 1차적인 검토 대상이 된다.

| 연산 우선순위 |             설명             |
| :-----------: | :--------------------------: |
|       1       |           괄호 ()            |
|       2       |          NOT 연산자          |
|       3       | 비교 연산자, SQL 비교 연산자 |
|       4       |             AND              |
|       5       |              OR              |



- ROWNUM : SQL 처리 결과 집합의 각 행에 대해 입시로 부여되는 일련번호로 테이블이나 집합에서 원하는 만큼의 행만 가져오고 싶을 때 WEHRE절에서 행의 개수를 제한하는 목적으로 사용
  - EX) SELECT PLAYER_NAME FROM PLAYER WHERE **ROWNUM = 1;**

- TOP : 결과 집합으로 출력되는 행의 수를 제한
  - EX) SELECT TOP(1) PLAYER_NAME FROM PLAYER;



### 함수

- 종류
  - 내장 함수
    - 단일행 함수
      - 입력되는 값이 아무리 많아도 출력은 하나만 된다 = M : 1 관계
      - SELECT, WHERE, ORDER BY 절에 사용 가능
      - 종류
        - 문자형 함수
        - 숫자형 함수
        - 날짜형 함수
        - 변환형 함수
          - 명시적 데이터 유형 변환 : 데이터 변환형 함수로 데이터 유형을 변환하도록 명시해 주는 경우
          - 암시적 데이터 유형 변환 : 데이터베이스가 자동으로 데이터 유형을 변환하여 계산하는 경우 -> 성능 저하 발생, 명시적 데이터 유형 변환 방법 사용권고
        - NULL 관련 함수
    - 다중행 함수
      - 집계 함수
      - 그룹 함수
      - 윈도우 함수
  - 사용자 정의 함수





### GROUP BY, HAVING 절

- 집계 함수

  - 여러 행들의 그룹이 모여서 그룹당 단 하나의 결과를 돌려주는 함수
  - SELECT, HAVING, ORDER BY 절에 사용 가능

- GROUP BY 절

  - FROM 절과 WHERE 절 뒤에 오며, 데이터들을 작을 그룹으로 분류하여 소그룹에 대한 항목별로  통계 정보를 얻을 때 추가로 사용

  > SELECT 컬럼명 FROM 테이블 명 WHERE 조건식 GROUP BY 컬럼 HAVING 조건식 ;

- HAVING 절

  - GROUP BY 절과 HAVING 절의 순서를 바꿔서 수행하더라도 문법 에러도 없고 결과물도 동일하지만 논리적으로 그룹핑되어 통계 정보가 만들어지고, 이후 적용된 결과에 대해서 제한 조건에 맞는 데이터를 추출하는 것이 논리적으로 맞으므로 GROUP BY 절과 HAVING 절의 순서를 지키는 것을 권고한다.



### ORDER BY 절

> SQL 문장으로 조회된 데이터들을 다양한 목적에 맞게 특정 칼럼을 기준으로 정렬하여 출력

- 정렬 방식을 지정하지 않으면 기본적으로 오름차순 적용



- SELECT 문장 실행 순서
  1. FROM
  2. WHERE
  3. GROUP BY
  4. HAVING
  5. SELECT 
  6. ORDER BY



### JOIN

> 두 개 이상의 테이블들을 연결 또는 결합하여 데이터를 출력하는 것

- FROM 절에 여러 테이블이 나열되더라도 SQL에서 데이터를 처리할 때는 단 **두개의 집합 간**에만 조인이 일어난다. 
- 종류
  - INNNER JOIN : 두 개의 테이블 간 컬럼 값이 서로 정확하게 일치하는 경우에 사용, 대부분 PK <-> FK 관계 기반
  - LEFT JOIN : 양쪽 테이블 데이터 집합에서 공통적으로 존재하는 데이터와 JOIN 키워드 왼쪽에 명시된 테이블에만 존재하는 데이터 추출
  - RIGHT JOIN : 양쪽 테이블 데이터 집합에서 공통적으로 존재하는 데이터와 JOIN 키워드 오른쪽에 명시된 테이블에만 존재하는 데이터 추출
  - OUTER JOIN : 양쪽 테이블 데이터 집합에서 공통적으로 존재하는 데이터와 한쪽 테이블에만 존재하는 데이터도 모두 추출

- 유의점
  - JOIN을 잘못 기술하게 되면 시스템 자원 부족이나 과다한 응답시간 지연을 발생시키는 중요 원인이 됨