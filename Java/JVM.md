# JVM

---

### JVM이란?

- JAVA Virtual Machine , 즉 자바 가상 머신의 약자
- 자바 애플리케이션을 `클래스 로더`를 통해 읽어 들여 자바 API와 함께 실행하는 것
- JAVA와 OS사이에서 중개자 역할 = JAVA가 OS에 구애받지 않고 재사용 가능하게 해줌
- 메모리관리, GC 수행
- 스택기반의 가상머신

### 가상머신이 뭔대?

- 프로그램을 실행하기 위해 물리적 머신과 유사한 머신을 소프트웨어로 구현한 것

### 자바 프로그램 실행 과정

- 프로그램이 실행되면 OS로부터 프로그램이 필요로하는 메모리 할당
- 자바 `컴파일러`가 자바 소스코드(.java)를 읽어들여 자바 바이트코드(.class)로 변환
- Class Loader를 통해 class파일을 JVM으로 로딩
- 로딩된 class파일들을 Execution Engine을 통해 해석
- 해석된 바이트코드는 Runtime Data Areas에 배치되어 실질적인 수행이 이루어짐
  
    ![stun](/res/JVM.png)
    

컴파일러?

- 고급 언어로 작성된 원시 프로그램을 입력으로 받아 기계어로 된 목적 프로그램을 출력하기 위해 사용되는 언어 번역 프로그램

런타임?

- 프로그램이 실행되고 있는 동안의 동작

[Class Lodader]

- Runtime시 JVM내로 .class 파일을 로드하고 링크를 통해 `배치`하는 작업을 수행
- 사용하지 않는 클래스들은 메모리에서 삭제
- 동적 로드 담당

[Execution Engine]

- 클래스를 `실행`시키는 역할
- 클래스 로더가 JVM 내의 Runtime Data Area에 바이트 코드를 배치시킨것이 Execution Engine에 의해서 실행
- 자바 바이트 코드를 명령어 단위로 읽어서 실행
  
  
    - Interpreter
        - 자바 바이트 코드를 명령어 단위로 읽어서 실행
        - 한 줄씩 실행하기 때문에 느린 단점
        
    - JIT(Just-In-Time) Compiler
        - 인터프리터 방식의 단점을 보완하기 위해 등장
        - 인터프리터 방식으로 실행하다가 적절한 시점에 바이트 코드 전체를 컴파일하여 네이티브 코드로 변경하고 이후에는 더 이상 인터프리팅하지 않고 네이티브 코드로 직접 실행하는 방식
        
    
    ⇒ 한 번만 실행되는 코드라면 인터프리팅하는 것이 유리
    
    ⇒ 해당 메소드가 얼마나 자주 수행되는지 체크하고 일정 정도를 넘을 때문 컴파일을 수행하는 것이 좋다
    
    - Garbage Collector
        - GC를 수행하는 모듈이 존재
    

[Runtime Data Area]

- JVM이 프로그램을 수행하기 위해 OS로부터 할당받는 메모리 공간
- 용도에 따라 여러 영역으로 나누어 관리
  
    ![stun](/res/RuntimeDataArea.png)
    
    - PC
        - Thread가 시작될 때, 각각의 Thread별로 생성되는 공간으로 현재 수행중인 JVM 명령어 주소를 가지게 된다.
        
    - JVM stack
        - 프로그램의 실행 과정에서 임시로 할당되었다가 메소드를 빠져나가면 소멸되는 특성의 데이터를 저장하기 위한 영역
        - 메소드의 매개변수, 지역 변수 등 메소드의 정보를 저장
    
    - Native Method stack
        - 자바외의 언어로 작성된 네이티브 코드를 위한 영역
        - 기계어로 작성된 프로그램을 실행시키는 영역
    
    - Method Area
        - 클래스 정보를 처음 메모리 공간에 올릴 때, 초기화되는 대상을 저장하기 위한 메모리 공간
        - 모든 쓰레드가 공유하는 메모리 영역
    
    - Heap
        - 객체를 저장하는 가상 메모리 공간
        
        - 런타임시 동적으로 할당하여 사용하는 영역
        
        - new 연산자로 생성된 객체와 배열을 저장
        
        - GC 관리 대상에 포함
          
            ![stun](/res/Heap.png)
            
            
    
    참고한 블로그
    
    [https://asfirstalways.tistory.com/158](https://asfirstalways.tistory.com/158)